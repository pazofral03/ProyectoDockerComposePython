{% extends "base.html" %}

{% block content %}

<div class="row mb-4">
    <div class="col-12 text-center">
        <h1 class="display-5">Dashboard Ejecutivo</h1>
        <p class="text-muted">AnÃ¡lisis de ventas con KPIs y evoluciÃ³n temporal</p>
    </div>
</div>

<div class="card bg-light mb-4 shadow-sm">
    <div class="card-body py-2">
        <form action="/" method="GET" class="row g-3 align-items-center justify-content-center">

            <div class="col-auto">
                <span class="fw-bold text-secondary">ğŸ” Filtros:</span>
            </div>

            <div class="col-auto">
                <select name="tiempo" class="form-select form-select-sm" onchange="this.form.submit()">
                    <option value="todo" {% if filtro_tiempo=='todo' %}selected{% endif %}>ğŸ“… HistÃ³rico Completo
                    </option>
                    <option value="30dias" {% if filtro_tiempo=='30dias' %}selected{% endif %}>ğŸ“… Ãšltimos 30 dÃ­as
                    </option>
                </select>
            </div>

            <div class="col-auto">
                <select name="orden" class="form-select form-select-sm" onchange="this.form.submit()">
                    <option value="cantidad" {% if filtro_orden=='cantidad' %}selected{% endif %}>ğŸ“Š Ordenar Barras:
                        Cantidad</option>
                    <option value="ingresos" {% if filtro_orden=='ingresos' %}selected{% endif %}>ğŸ’² Ordenar Barras:
                        Rentabilidad</option>
                </select>
            </div>

            <div class="col-auto border-start ps-3"></div>

            <div class="col-auto">
                <a href="/reporte_pdf?tiempo={{ filtro_tiempo }}&orden={{ filtro_orden }}"
                    class="btn btn-danger btn-sm shadow-sm">
                    ğŸ“„ Descargar PDF
                </a>
            </div>
        </form>
    </div>
</div>

{% if kpis %}
<div class="row text-center mb-4">
    <div class="col-md-4">
        <div class="card text-white bg-primary mb-3 shadow">
            <div class="card-header">Ingreso Total</div>
            <div class="card-body">
                <h2 class="card-title">{{ kpis.total_ingresos }} â‚¬</h2>
            </div>
        </div>
    </div>
    <div class="col-md-4">
        <div class="card text-white bg-success mb-3 shadow">
            <div class="card-header">Ticket Medio</div>
            <div class="card-body">
                <h2 class="card-title">{{ kpis.ticket_medio }} â‚¬</h2>
            </div>
        </div>
    </div>
    <div class="col-md-4">
        <div class="card text-white bg-warning mb-3 shadow">
            <div class="card-header text-dark">Top Producto</div>
            <div class="card-body text-dark">
                <h2 class="card-title">{{ kpis.top_producto }}</h2>
            </div>
        </div>
    </div>
</div>
{% endif %}

{% if plot_barras %}
<div class="row">
    <div class="col-12 col-md-6 mb-4">
        <div class="card shadow-sm h-100">
            <div class="card-body text-center">
                <img src="data:image/png;base64,{{ plot_barras }}" class="img-fluid" alt="GrÃ¡fico Barras">
            </div>
        </div>
    </div>

    <div class="col-12 col-md-6 mb-4">
        <div class="card shadow-sm h-100">
            <div class="card-body text-center">
                <img src="data:image/png;base64,{{ plot_tarta }}" class="img-fluid" alt="GrÃ¡fico Tarta">
            </div>
        </div>
    </div>

    <div class="col-12 col-md-6 mb-4">
        <div class="card shadow-sm h-100">
            <div class="card-body text-center">
                <img src="data:image/png;base64,{{ plot_pareto }}" class="img-fluid" alt="GrÃ¡fico Pareto">
            </div>
        </div>
    </div>

    <div class="col-12 col-md-6 mb-4">
        <div class="card shadow-sm h-100">
            <div class="card-body text-center">
                <img src="data:image/png;base64,{{ plot_timeline }}" class="img-fluid" alt="GrÃ¡fico Timeline">
            </div>
        </div>
    </div>
</div>
{% else %}
<div class="row">
    <div class="col-12">
        <div class="alert alert-warning m-4 text-center">
            No hay datos suficientes para generar los grÃ¡ficos.
            <a href="/gestion" class="alert-link">Ve a GestiÃ³n</a> y aÃ±ade ventas.
        </div>
    </div>
</div>
{% endif %}

{% endblock %}